---
- hosts: test_machine
  gather_facts: false
  become_user: root
  become: true
  
  environment: "{{ env }}"
    
  tasks:
  
    - name: Find frontend
      shell:
        kubectl  --kubeconfig ~/certs.{{ ucp_username }}/kube.yml  get svc frontend
      register: frontend_svc
      
    - set_fact: 
        frontend_port: "{{ frontend_svc | json_query(query) }}"
      vars:
        query: "spec.port[*].nodePort"    
        
    - debug: var=frontend_port   
      
    - name: Run test passing in PORT and MESSAGE
      shell:
        node puppeteer-test/puppeteer-test.js
      environment:
        PORT: " {{ frontend_port }} "
        MESSAGE: "test message from ansible"
    
    
